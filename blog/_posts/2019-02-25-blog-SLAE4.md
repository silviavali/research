---
layout: post
title: Writing a 64-bit custom encoder
#description: >
#  This blog post covers the 4th task of the SLAE certificate exam where the goal is to write an encoder of your own choice and then write a decoder routine for it in assembly.
#hide_description: true
#image: /assets/img/blog/example-content-ii.jpg
---

This blog post covers the 4/7 task of the [SLAE certificate exam](https://www.pentesteracademy.com/course?id=7) where we are going to create our own custom encoding scheme in order to use it with an execve-stack as shellcode. As a second step I am presenting a decoder routine for the custom encoding sceme which decodes the shellcode in memory when ran.<br>
<b>Student ID</b>: SLAE64 - 1594

<b>Task:</b>

* Create a custom encoding scheme like the "Insertion Encoder" we showed you
* P0C with using execve-stack as the shellcode to encode with your schema and execute


Execve-stack shellcode:
```
global _start

section .text

_start:

	; First NULL push

	xor rax, rax
	push rax

	; push /bin//sh in reverse

	mov rbx, 0x68732f2f6e69622f
	push rbx

	; store /bin//sh address in RDI

	mov rdi, rsp

	; Second NULL push
	push rax

	; set RDX
	mov rdx, rsp


	; Push address of /bin//sh
	push rdi

	; set RSI

	mov rsi, rsp

	; Call the Execve syscall
	add rax, 59
	syscall
```

Dumping the shellcode as hexadecimal string:
```
objdump -d ./Execve-Stack|grep '[0-9a-f]:'|grep -v 'file'|cut -f2 -d:|cut -f1-6 -d' '|tr -s ' '|tr '\t' ' '|sed 's/ $//g'|sed 's/ /\\x/g'|paste -d '' -s |sed 's/^/"/'|sed 's/$/"/g'

"\x48\x31\xc0\x50\x48\xbb\x2f\x62\x69\x6e\x2f\x73\x68\x53\x48\x89\xe7\x50\x48\x89\xe2\x57\x48\x89\xe6\x48\x83\xc0\x3b\x0f\x05"
```



* * *

* Encoder.py<br> [https://github.com/silviavali/SLAE/blob/master/task4/encoder.py](https://github.com/silviavali/SLAE/blob/master/task4/encoder.py)
* Decoder.nasm: <br>[https://github.com/silviavali/SLAE/blob/master/task4/decoder.nasm](https://github.com/silviavali/SLAE/blob/master/task4/decoder.nasm)
